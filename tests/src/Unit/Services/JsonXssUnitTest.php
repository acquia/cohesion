<?php

namespace Drupal\Tests\cohesion\Unit\Services;

use Drupal\cohesion\Services\JsonXss;
use Drupal\Core\Session\AccountInterface;
use Drupal\Tests\UnitTestCase;

/**
 * Class JsonXssMock.
 *
 * @package Drupal\Tests\cohesion\Unit\Services
 */
class JsonXssMock extends JsonXss {
}

/**
 * @group Cohesion
 */
class JsonXssUnitTest extends UnitTestCase {

  protected $mockUnit;

  public function setUp(): void {
    // Create a mock of the classes required to init JsonXss.
    $prophecy = $this->prophesize(AccountInterface::CLASS);
    $account = $prophecy->reveal();

    $this->mockUnit = new JsonXssMock($account);
  }

  /**
   * @covers \Drupal\cohesion\Services\JsonXss::buildXssPaths
   */
  public function testBuildXssPaths() {
    $paths = $this->mockUnit->buildXssPaths('{"canvas":[{"type":"item","uid":"wysiwyg","title":"WYSIWYG","status":{"collapsed":true},"uuid":"237f627e-a58e-4998-8e10-5e296b65c7e3","parentUid":"root","isContainer":false,"children":[]}],"componentForm":[],"model":{"237f627e-a58e-4998-8e10-5e296b65c7e3":{"settings":{"title":"WYSIWYG","content":"<script>x();<\/script>"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"wysiwyg"}},"markup":{"attributes":[{"attribute":"onclick","value":"x();"}],"prefix":"<script>x();<\/script>","suffix":"<script>x();<\/script>"}}},"mapper":{"237f627e-a58e-4998-8e10-5e296b65c7e3":{"settings":{"topLevel":{"formDefinition":[{"formKey":"wysiwyg-settings","children":[{"formKey":"wysiwyg-editor","breakpoints":[],"activeFields":[{"name":"content","active":true}]}]}],"selectorType":"topLevel","form":null},"dropzone":[],"selectorType":"topLevel"},"markup":{"topLevel":{"formDefinition":[{"formKey":"tab-markup-classes-and-ids","children":[{"formKey":"tab-markup-add-classes","breakpoints":[],"activeFields":[{"name":"classes","active":true}]}]},{"formKey":"tab-markup-attributes","children":[{"formKey":"tab-markup-add-attributes-values","breakpoints":[],"activeFields":[{"name":"attributes","active":true},{"name":"attribute","active":true},{"name":0,"active":true}]}]},{"formKey":"tab-markup-prefix-and-suffix","children":[{"formKey":"tab-markup-prefix-markup-before-region","breakpoints":[],"activeFields":[{"name":"prefix","active":true}]},{"formKey":"tab-markup-suffix-markup-after-region","breakpoints":[],"activeFields":[{"name":"suffix","active":true}]}]}],"title":"Markup","selectorType":"topLevel","form":null},"dropzone":[],"title":"Markup","selectorType":"topLevel"}}},"previewModel":{"237f627e-a58e-4998-8e10-5e296b65c7e3":{"settings":{"content":{"text":"<script>x();<\/script>","textFormat":"cohesion"}}}},"variableFields":{"237f627e-a58e-4998-8e10-5e296b65c7e3":["settings.content"]}}');
    $linkToPage_paths = $this->mockUnit->buildXssPaths('{"canvas":[{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"parentUid":"root","uuid":"f8037a29-e32f-4f5b-bf8b-068e17715144","isContainer":true,"children":[]},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"children":[],"uuid":"c14d8fe4-21f8-4649-bec5-64d5d071f1a7","parentUid":"root","isContainer":true},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"children":[],"uuid":"b74e583b-09dd-4d0e-b8ab-162a5c912b59","parentUid":"root","isContainer":true},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"children":[],"uuid":"feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9","parentUid":"root","isContainer":true},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"children":[],"uuid":"bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6","parentUid":"root","isContainer":true},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"children":[],"uuid":"831ddb73-0c98-42b4-bbd8-6d17e608f855","parentUid":"root","isContainer":true}],"mapper":{"f8037a29-e32f-4f5b-bf8b-068e17715144":{},"c14d8fe4-21f8-4649-bec5-64d5d071f1a7":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"b74e583b-09dd-4d0e-b8ab-162a5c912b59":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"831ddb73-0c98-42b4-bbd8-6d17e608f855":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}}},"model":{"f8037a29-e32f-4f5b-bf8b-068e17715144":{"settings":{"title":"Link with JS","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkToPage":"javascript: { alert(document.domain); alert(document.cookie); }","linkText":"Click me"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"c14d8fe4-21f8-4649-bec5-64d5d071f1a7":{"settings":{"title":"Link to node","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkText":"Click me 2","linkToPage":"node::4"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"b74e583b-09dd-4d0e-b8ab-162a5c912b59":{"settings":{"title":"Link to external url","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkText":"Visit Acquia.com","linkToPage":"https://www.acquia.com"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9":{"settings":{"title":"Link to internal page","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkText":"Go to my page","linkToPage":"/my-page"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6":{"settings":{"title":"Link to mail","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkText":"Mailto","linkToPage":"mailto:test@test.com"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"831ddb73-0c98-42b4-bbd8-6d17e608f855":{"settings":{"title":"Link with script tag","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"internal-page","target":"_self","linkText":"Click me 3","linkToPage":"<script></script>"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}}},"previewModel":{"f8037a29-e32f-4f5b-bf8b-068e17715144":{},"c14d8fe4-21f8-4649-bec5-64d5d071f1a7":{},"b74e583b-09dd-4d0e-b8ab-162a5c912b59":{},"feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9":{},"bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6":{},"831ddb73-0c98-42b4-bbd8-6d17e608f855":{}},"variableFields":{"f8037a29-e32f-4f5b-bf8b-068e17715144":[],"c14d8fe4-21f8-4649-bec5-64d5d071f1a7":[],"b74e583b-09dd-4d0e-b8ab-162a5c912b59":[],"feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9":[],"bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6":[],"831ddb73-0c98-42b4-bbd8-6d17e608f855":[]},"meta":{"fieldHistory":[]}}');
    $url_paths = $this->mockUnit->buildXssPaths('{"canvas":[{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"parentUid":"root","uuid":"2b4ac74e-6753-49a0-a35b-2316a7c9edb5","isContainer":true,"children":[]},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"parentUid":"root","uuid":"868460cc-c0d6-470b-80cc-0cb7796e3952","isContainer":true,"children":[]},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"parentUid":"root","uuid":"d74ea388-cc55-4969-9a32-5c109094e6d9","isContainer":true,"children":[]},{"type":"container","uid":"link","title":"Link","status":{"collapsed":true},"parentUid":"root","uuid":"5e11439a-d5f9-4240-b841-a517715a63db","isContainer":true,"children":[]}],"mapper":{"2b4ac74e-6753-49a0-a35b-2316a7c9edb5":{},"868460cc-c0d6-470b-80cc-0cb7796e3952":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"d74ea388-cc55-4969-9a32-5c109094e6d9":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}},"5e11439a-d5f9-4240-b841-a517715a63db":{"settings":{"formDefinition":[{"formKey":"link-settings","children":[{"formKey":"link-link","breakpoints":[],"activeFields":[{"name":"linkText","active":true},{"name":"titleAttribute","active":true},{"name":"type","active":true},{"name":"linkToPage","active":true},{"name":"url","active":true},{"name":"anchor","active":true},{"name":"scrollToSelector","active":true},{"name":"scrollToDuration","active":true},{"name":"scrollToOffsetType","active":true},{"name":"scrollToOffsetPx","active":true},{"name":"scrollToOffsetElement","active":true},{"name":"target","active":true},{"name":"helpText","active":true},{"name":"triggerId","active":true},{"name":"modalId","active":true}]},{"formKey":"link-modifier","breakpoints":[],"activeFields":[{"name":"modifier","active":true},{"name":"modifierType","active":true},{"name":"interactionScope","active":true},{"name":"interactionParent","active":true},{"name":"interactionTarget","active":true},{"name":"modifierName","active":true}]},{"formKey":"link-animation","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"linkAnimation","active":true},{"name":"animationType","active":true},{"name":"animationScope","active":true},{"name":"animationParent","active":true},{"name":"animationTarget","active":true},{"name":"animationScale","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDirection","active":true},{"name":"animationDistance","active":true},{"name":"animationPieces","active":true},{"name":"animationOrigin","active":true},{"name":"animationFoldHeight","active":true},{"name":"animationHorizontalFirst","active":true},{"name":"animationIterations","active":true},{"name":"animationEasing","active":true},{"name":"animationDuration","active":true}]},{"formKey":"link-style","breakpoints":[],"activeFields":[{"name":"customStyle","active":true},{"name":"customStyle","active":true}]}]}],"selectorType":"topLevel","form":null,"items":[]}}},"model":{"2b4ac74e-6753-49a0-a35b-2316a7c9edb5":{"settings":{"title":"Link to internal page","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"url","target":"_self","linkText":"Click me 1","url":"/my-page"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"868460cc-c0d6-470b-80cc-0cb7796e3952":{"settings":{"title":"Link to external page","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"url","target":"_self","linkText":"Click me 2","url":"https://www.acquia.com"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"d74ea388-cc55-4969-9a32-5c109094e6d9":{"settings":{"title":"Link to mail","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"url","target":"_self","linkText":"Click me 3","url":"mailto:test@test.com"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}},"5e11439a-d5f9-4240-b841-a517715a63db":{"settings":{"title":"Link to JS","customStyle":[{"customStyle":""}],"settings":{"type":"internal-page","target":"_self","customStyle":[{"customStyle":""}]},"type":"url","target":"_self","linkText":"Click me 3","url":"javascript: { alert(document.domain); alert(document.cookie); }"},"context-visibility":{"contextVisibility":{"condition":"ALL"}},"styles":{"settings":{"element":"link"}}}},"previewModel":{"2b4ac74e-6753-49a0-a35b-2316a7c9edb5":{},"868460cc-c0d6-470b-80cc-0cb7796e3952":{},"d74ea388-cc55-4969-9a32-5c109094e6d9":{},"5e11439a-d5f9-4240-b841-a517715a63db":{}},"variableFields":{"2b4ac74e-6753-49a0-a35b-2316a7c9edb5":[],"868460cc-c0d6-470b-80cc-0cb7796e3952":[],"d74ea388-cc55-4969-9a32-5c109094e6d9":[],"5e11439a-d5f9-4240-b841-a517715a63db":[]},"meta":{"fieldHistory":[]}}');

    $this->assertEquals(5, count($paths));
    $this->assertArrayHasKey('237f627e-a58e-4998-8e10-5e296b65c7e3.settings.content', $paths);
    $this->assertArrayHasKey('237f627e-a58e-4998-8e10-5e296b65c7e3.markup.prefix', $paths);
    $this->assertArrayHasKey('237f627e-a58e-4998-8e10-5e296b65c7e3.markup.suffix', $paths);
    $this->assertArrayHasKey('237f627e-a58e-4998-8e10-5e296b65c7e3.markup.attributes.0.attribute', $paths);
    $this->assertArrayHasKey('237f627e-a58e-4998-8e10-5e296b65c7e3.markup.attributes.0.value', $paths);

    $this->assertEquals(2, count($linkToPage_paths));
    $this->assertArrayHasKey('f8037a29-e32f-4f5b-bf8b-068e17715144.settings.linkToPage', $linkToPage_paths);
    $this->assertArrayHasKey('831ddb73-0c98-42b4-bbd8-6d17e608f855.settings.linkToPage', $linkToPage_paths);
    // test that correct links are not added - node::1, /my-page, mailto:, external links.
    $this->assertArrayNotHasKey('c14d8fe4-21f8-4649-bec5-64d5d071f1a7.settings.linkToPage', $linkToPage_paths);
    $this->assertArrayNotHasKey('b74e583b-09dd-4d0e-b8ab-162a5c912b59.settings.linkToPage', $linkToPage_paths);
    $this->assertArrayNotHasKey('feacb1f2-2cb1-4a9e-a25f-acfb0c8e53c9.settings.linkToPage', $linkToPage_paths);
    $this->assertArrayNotHasKey('bc495895-0f3a-4aaa-9e3d-11b75a9a2eb6.settings.linkToPage', $linkToPage_paths);

    $this->assertEquals(1, count($url_paths));
    $this->assertArrayHasKey('5e11439a-d5f9-4240-b841-a517715a63db.settings.url', $url_paths);
    // test that correct links are not added - /my-page, mailto:, external links.
    $this->assertArrayNotHasKey('d74ea388-cc55-4969-9a32-5c109094e6d9.settings.url', $url_paths);
    $this->assertArrayNotHasKey('868460cc-c0d6-470b-80cc-0cb7796e3952.settings.url', $url_paths);
    $this->assertArrayNotHasKey('2b4ac74e-6753-49a0-a35b-2316a7c9edb5.settings.url', $url_paths);
  }

}
