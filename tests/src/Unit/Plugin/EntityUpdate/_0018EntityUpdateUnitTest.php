<?php

namespace Drupal\Tests\cohesion\Unit\Plugin\EntityUpdate;

use Drupal\cohesion\Plugin\EntityUpdate\_0018EntityUpdate;
use Drupal\Tests\UnitTestCase;

/**
 * @group Cohesion
 */
class _0018EntityUpdateUnitTest extends UnitTestCase {

  /**
   * @var unit_0018MockUpdateEntity*/
  protected $unit;

  private $fixture_mapper = '{"styles":{"topLevel":{"title":"Heading","selectorType":"topLevel","formDefinition":[{"formKey":"font","children":[{"formKey":"font-and-color","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"font-family","active":true},{"name":"font-weight","active":true},{"name":"color","active":true}]},{"formKey":"font-sizing-and-alignment","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"font-size","active":true},{"name":"line-height","active":true},{"name":"text-align","active":true},{"name":"letter-spacing","active":false},{"name":"word-spacing","active":false},{"name":"text-indent","active":false}]}]},{"formKey":"layout","children":[{"formKey":"margin","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"margin-equal","active":false},{"name":"margin-top","active":true},{"name":"margin-bottom","active":true},{"name":"margin-left","active":true},{"name":"margin-right","active":true}]}]}],"form":{"type":"cohFormBuilder","element":"h1","currentLevel":"h1","defaultKey":"custom-styles-heading","items":[{"type":"cohAccordion","htmlClass":"coh-accordion-panel-body--bleed coh-accordion-panel-body--dark","title":"Font","weight":1,"formKey":"font","isOpen":true,"options":["font-and-color","font-sizing-and-alignment","font-style-and-wrapping","text-shadow"],"items":[{"type":"cohSection","title":"Font and color","formKey":"font-and-color","helpKey":"css-font-and-color","weight":1,"breakpoints":true,"items":[{"type":"fieldsetArray","items":[{"key":["xl"],"title":"xl","type":"cohBreakpointFieldset","items":[{"type":"cohSelect","key":["styles","styles","xl","font-family","value"],"title":"Font family","isStyle":true,"defaultActive":true,"valueProperty":"stack.variable","labelProperty":"stack.name","endpoint":"/cohesionapi/main/font_libraries","schema":{"type":"string"},"isActive":true,"originalKeyValue":["styles","xl","font-family","value"],"ngModelOptions":{},"loading":false,"cohIdKey":"styles_8sgif8519y","isVariableMode":false,"options":[{"stack":{"name":" "},"nullOption":true},{"stack":{"inuse":true,"systemfont":false,"name":"Playfair Display","uid":"playfair-display","class":".coh-font-playfair-display","variable":"$coh-font-playfair-display","fontStack":"\'\'Playfair Display\'\', serif","smoothing":{"firefox":true,"webkit":true}}},{"stack":{"inuse":true,"systemfont":false,"fontStack":"\'\'Roboto\'\', sans-serif","name":"Roboto","uid":"roboto","class":".coh-font-roboto","variable":"$coh-font-roboto","smoothing":{"firefox":true,"webkit":true}}}]},{"type":"cohTextBox","key":["styles","styles","xl","font-weight","value"],"title":"Font weight","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssFontWeight","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","font-weight","value"],"ngModelOptions":{},"cohIdKey":"styles_0qamb7vlzc","isVariableMode":false,"$validators":{}},{"type":"cohColourPickerOpener","key":["styles","styles","xl","color","value"],"title":"Font color","isStyle":true,"defaultActive":true,"schema":{"type":"object"},"isActive":true,"originalKeyValue":["styles","xl","color","value"],"ngModelOptions":{},"cohIdKey":"styles_h72nxx2iwp","isVariableMode":false,"colourPickerOptions":{"flat":true},"options":{"preferredFormat":"hex"}}],"ngModelOptions":{}}]}],"mapperKey":"styles","currentBreakpoints":[{"iconName":"television","name":"xl"}],"ngModelOptions":{}},{"type":"cohSection","title":"Font sizing and alignment","formKey":"font-sizing-and-alignment","helpKey":"css-font-sizing-and-alignment","weight":2,"breakpoints":true,"items":[{"type":"fieldsetArray","items":[{"key":["xl"],"title":"xl","type":"cohBreakpointFieldset","items":[{"type":"cohTextBox","key":["styles","styles","xl","font-size","value"],"title":"Font size","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssPositiveLengthWithFontSize","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","font-size","value"],"ngModelOptions":{},"cohIdKey":"styles_2uelr7goy4","isVariableMode":false,"$validators":{}},{"type":"cohTextBox","key":["styles","styles","xl","line-height","value"],"title":"Line height","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssPositiveLengthWithNormal","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","line-height","value"],"ngModelOptions":{},"cohIdKey":"styles_psbyvv2c4g","isVariableMode":false,"$validators":{}},{"type":"cohSelect","key":["styles","styles","xl","text-align","value"],"title":"Text align","options":[{"label":" ","nullOption":true},{"label":"Left","value":"left"},{"label":"Right","value":"right"},{"label":"Center","value":"center"}],"isStyle":true,"defaultActive":true,"schema":{"type":"string"},"isActive":true,"originalKeyValue":["styles","xl","text-align","value"],"ngModelOptions":{},"cohIdKey":"styles_q9oh2rkdyd","isVariableMode":false},{"type":"cohTextBox","key":["styles","styles","xl","letter-spacing","value"],"title":"Letter spacing","isStyle":true,"schema":{"type":"string","cohValidate":["cssLengthNoPercentWithNormal","scssVariable"]},"isActive":false,"originalKeyValue":["styles","xl","letter-spacing","value"]},{"type":"cohTextBox","key":["styles","styles","xl","word-spacing","value"],"title":"Word spacing","isStyle":true,"schema":{"type":"string","cohValidate":["cssLengthNoPercentWithNormal","scssVariable"]},"isActive":false,"originalKeyValue":["styles","xl","word-spacing","value"]},{"type":"cohTextBox","key":["styles","styles","xl","text-indent","value"],"title":"Text indent","isStyle":true,"schema":{"type":"string","cohValidate":["cssLength","scssVariable"]},"isActive":false,"originalKeyValue":["styles","xl","text-indent","value"]}],"ngModelOptions":{}}]}],"mapperKey":"styles","currentBreakpoints":[{"iconName":"television","name":"xl"}],"ngModelOptions":{}}],"ngModelOptions":{}},{"type":"cohAccordion","htmlClass":"coh-accordion-panel-body--bleed coh-accordion-panel-body--dark","title":"Layout","weight":3,"formKey":"layout","isOpen":true,"options":["height","width","padding","margin","float","position","display","opacity","vertical-alignment","multi-column-layout","flex-container","flex-item","box-shadow"],"items":[{"type":"cohSection","title":"Margin","formKey":"margin","helpKey":"css-layout-margin","weight":4,"breakpoints":true,"items":[{"type":"fieldsetArray","items":[{"key":["xl"],"title":"xl","type":"cohBreakpointFieldset","items":[{"type":"cohTextBox","key":["styles","styles","xl","margin","margin-equal","value"],"title":"Margin equal","isStyle":true,"defaultActive":false,"schema":{"type":"string","cohValidate":["cssLengthWithAuto","scssVariable"]},"isActive":false,"originalKeyValue":["styles","xl","margin","margin-equal","value"]},{"type":"cohTextBox","key":["styles","styles","xl","margin","margin-top","value"],"title":"Margin top","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","margin","margin-top","value"],"ngModelOptions":{},"cohIdKey":"styles_c6or3lf309","isVariableMode":false,"$validators":{}},{"type":"cohTextBox","key":["styles","styles","xl","margin","margin-bottom","value"],"title":"Margin bottom","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","margin","margin-bottom","value"],"ngModelOptions":{},"cohIdKey":"styles_uwempg1rvz","isVariableMode":false,"$validators":{}},{"type":"cohTextBox","key":["styles","styles","xl","margin","margin-left","value"],"title":"Margin left","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","margin","margin-left","value"],"ngModelOptions":{},"cohIdKey":"styles_982unszuwx","isVariableMode":false,"$validators":{}},{"type":"cohTextBox","key":["styles","styles","xl","margin","margin-right","value"],"title":"Margin right","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","margin","margin-right","value"],"ngModelOptions":{},"cohIdKey":"styles_jenij7dxmhl","isVariableMode":false,"$validators":{}}],"ngModelOptions":{}}]}],"mapperKey":"styles","currentBreakpoints":[{"iconName":"television","name":"xl"}],"ngModelOptions":{}}],"ngModelOptions":{}}],"ngModelOptions":{},"isOpen":true,"mapperKey":"styles","currentLevelTitle":"Default"}},"dropzone":[{"title":":active","type":"container","items":[{"title":":before","type":"container","items":[],"form":{"type":"cohFormBuilder","element":"h1","currentLevel":"h1","defaultKey":"custom-styles-heading","items":[{"type":"cohAccordion","htmlClass":"coh-accordion-panel-body--bleed coh-accordion-panel-body--dark","title":"Layout","weight":3,"formKey":"layout","isOpen":true,"options":["height","width","padding","margin","float","position","display","opacity","vertical-alignment","multi-column-layout","flex-container","flex-item","box-shadow"],"items":[{"type":"cohSection","title":"Height","formKey":"height","helpKey":"css-layout-height","weight":1,"breakpoints":true,"items":[{"type":"fieldsetArray","items":[{"key":["xl"],"title":"xl","type":"cohBreakpointFieldset","items":[{"type":"cohTextBox","key":["styles","pseudos",0,"pseudos",0,"styles","xl","min-height","value"],"title":"Min height","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssPositiveLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","min-height","value"]},{"type":"cohTextBox","key":["styles","pseudos",0,"pseudos",0,"styles","xl","max-height","value"],"title":"Max height","isStyle":true,"schema":{"type":"string","cohValidate":["cssPositiveLengthWithNone","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","max-height","value"]},{"type":"cohTextBox","key":["styles","pseudos",0,"pseudos",0,"styles","xl","height","value"],"title":"Fixed height","isStyle":true,"schema":{"type":"string","cohValidate":["cssPositiveLengthWithAuto","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","height","value"]}]}]}],"mapperKey":"styles","currentBreakpoints":[{"iconName":"television","name":"xl"}]}]}],"ngModelOptions":{},"isOpen":true,"mapperKey":"styles","currentLevelTitle":"Default"},"selectorType":"pseudo","oldModelKey":["pseudos",0,"pseudos",0],"prevKey":["pseudos",0,"pseudos",0],"allowedTypes":["child","pseudo"],"formDefinition":[{"formKey":"layout","children":[{"formKey":"height","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"min-height","active":true},{"name":"max-height","active":true},{"name":"height","active":true}]}]}]}],"form":{"type":"cohFormBuilder","element":"h1","currentLevel":"h1","defaultKey":"custom-styles-heading","items":[{"type":"cohAccordion","htmlClass":"coh-accordion-panel-body--bleed coh-accordion-panel-body--dark","title":"Font","weight":1,"formKey":"font","isOpen":true,"options":["font-and-color","font-sizing-and-alignment","font-style-and-wrapping","text-shadow"],"items":[{"type":"cohSection","title":"Font and color","formKey":"font-and-color","helpKey":"css-font-and-color","weight":1,"breakpoints":true,"items":[{"type":"fieldsetArray","items":[{"key":["xl"],"title":"xl","type":"cohBreakpointFieldset","items":[{"type":"cohSelect","key":["styles","pseudos",0,"styles","xl","font-family","value"],"title":"Font family","isStyle":true,"defaultActive":true,"valueProperty":"stack.variable","labelProperty":"stack.name","endpoint":"/cohesionapi/main/font_libraries","schema":{"type":"string"},"isActive":true,"originalKeyValue":["styles","xl","font-family","value"]},{"type":"cohTextBox","key":["styles","pseudos",0,"styles","xl","font-weight","value"],"title":"Font weight","isStyle":true,"defaultActive":true,"schema":{"type":"string","cohValidate":["cssFontWeight","scssVariable"]},"isActive":true,"originalKeyValue":["styles","xl","font-weight","value"]},{"type":"cohColourPickerOpener","key":["styles","pseudos",0,"styles","xl","color","value"],"title":"Font color","isStyle":true,"defaultActive":true,"schema":{"type":"object"},"isActive":true,"originalKeyValue":["styles","xl","color","value"]}]}]}],"mapperKey":"styles","currentBreakpoints":[{"iconName":"television","name":"xl"}]}]}],"ngModelOptions":{},"isOpen":true,"mapperKey":"styles","currentLevelTitle":"Default"},"selectorType":"pseudo","prevKey":["pseudos",0],"allowedTypes":["child","pseudo"],"formDefinition":[{"formKey":"font","children":[{"formKey":"font-and-color","breakpoints":[{"name":"xl"}],"activeFields":[{"name":"font-family","active":true},{"name":"font-weight","active":true},{"name":"color","active":true}]}]}]}],"selectorType":"topLevel"}}';

  /**
   * {@inheritdoc}
   */
  public function setUp() {
    $this->unit = new _0018EntityUpdate([], NULL, NULL);
  }

  /**
   * @covers \Drupal\cohesion\Plugin\EntityUpdate\_0018EntityUpdate::runUpdate
   */
  public function testRunUpdate() {

    $mapper = json_decode($this->fixture_mapper);

    $this->assertNotNull($mapper->styles->topLevel->form);
    $this->assertNotNull($mapper->styles->dropzone[0]->items[0]->form);
    $this->assertNotNull($mapper->styles->dropzone[0]->form);

    $this->unit->recurseMapper($mapper);

    $this->assertNull($mapper->styles->topLevel->form);
    $this->assertNull($mapper->styles->dropzone[0]->items[0]->form);
    $this->assertNull($mapper->styles->dropzone[0]->form);

  }

}
